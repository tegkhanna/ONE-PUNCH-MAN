<!DOCTYPE html>
<html>
<head>
	<title>Game</title>
	<link rel="stylesheet" type="text/css" href="project.css">
	<script type="text/javascript">


	//game window in form of object
	var gameWindow = 
	{
		canvas : null,
		context : null,
		init : function()//initializes the canvas and context
			{
				this.canvas = document.getElementById("canvas");
				this.context = this.canvas.getContext("2d");
				this.canvas.tabIndex = 1000;
			}
	};


	var down = [];//array  having down key 
	function keyIsDown(e)//adding key to donw
{
	if(down.indexOf(e.keyCode) == -1)
	{
		down.push(e.keyCode);
	}
}
function keyIsUp(e)//remove key from down
{
	if(down.indexOf(e.keyCode) != -1)
	{
		down.splice(down.indexOf(e.keyCode), 1);
	}
}

function checkKeyDown(x)//checks that a given key x is down
{
	if(x == 'w')
		x = 87;
	else if(x == 'a')
		x=65;
	else if(x=='s')
		x=83;
	else if(x=='d') 
		x=68;
	else if(x==' ') 
		x=32;
	else if(x == '8')
		x = 104;
	else if(x == '4')
		x=100;
	else if(x=='5')
		x=101;
	else if(x=='6') 
		x=102;
	else if(x=='p') 
		x=80;
	if(down.indexOf(x)!=-1)
		return true;
	else
		return false;
}
	 var fighter1=//fighter 1 object..has images..posiition..velocities..updates
    {
    	imgStand1: new Image(),
    	imgStand2: new Image(),
    	imgStand1b: new Image(),
    	imgStand2b: new Image(),
     	imgPunch: new Image(),
     	imgPunchb: new Image(),
     	x:10,
     	y:450,
     	width:80,
     	speed : 5,
     	health:100,
     	uVer : 0,
     	aVer : 0,
     	dir : 1,
     	move:0,
     	curr:1,
     	timeTillNextPunch : 0,
     	isInAir : false,
     	isPunching : false,
     	jump: function()
     	{	
     		if(!this.isInAir)
     		{	
     			this.uVer = 14;
     			this.aVer = 0.5;
     			this.isInAir = true;
     		}
     	},
     	punch : function()
     	{
     		this.isPunching = true;
     		this.width = 150;
     	},
     	update: function()
     	{
     		if(checkKeyDown('q') && this.timeTillNextPunch == 0)
     		{
     			this.punch();
     			this.timeTillNextPunch = 30;
     		}
     		else if (checkKeyDown('d') && checkKeyDown('w'))
     		{
     			this.move = 1;
     			this.dir = 1;
     			this.jump();	
     		}
     		else if (checkKeyDown('a') && checkKeyDown('w'))
     		{
     			this.move = 1;
     			this.dir = -1;
     			this.jump();	
     		}
     		else if(checkKeyDown('w'))
     			this.jump();
     		else if(checkKeyDown('d'))
     		{
     			this.move = 1;
     			this.dir = 1;
     		}
     		else if(checkKeyDown('a'))
     		{
     			this.move = 1;
     			this.dir = -1;
     		}
  
     		if(this.x>=10 && this.x<=750 && this.move==1)
     		{
     			this.x+=(this.dir*this.speed);
     			this.move=0;
     		}
     		else if(this.x<10)
     		{
     			this.x=10;move=0;
     		}
     		else if(this.x>750)
     		{
     			this.x=750;this.move=0;
     		}

     		this.y-=this.uVer;
     		this.uVer = this.uVer - this.aVer;

     		if(this.y>=450)
     		{
     			this.uVer = 0;
     			this.aVer = 0;
     			this.y = 450;
     			this.isInAir = false;
     		}

     		if(checkKeyDown(' ') && this.timeTillNextPunch == 0)
     		{
     			this.punch();
     			this.timeTillNextPunch = 25;
     		}
     		if(this.timeTillNextPunch!=0)
     		{
     			this.timeTillNextPunch--;
     			if(this.timeTillNextPunch == 20)
     			{	
     				this.isPunching = false;
     				this.width = 80;
     			}
     		}

     	},
     	isCollidng:function()
		{
			var t1 =  (this.x-fighter2.x)/2; var t2 = (this.y - fighter1.y)/2
			if(this.dir == 1 && this.x < fighter2.x)
			{
				if((this.x + this.width - fighter2.x) > 0 && Math.abs(fighter1.y - fighter2.y) <80)
				{
					if(!this.isPunching)
						this.x+=t1;fighter2.x-=t1;
					return true;
				}
			}
			else if(this.dir == -1 && this.x > fighter2.x)
			{
				if((this.x - fighter2.x - this.width) < 0 && Math.abs(fighter1.y - fighter2.y) <80)
				{
					//t1+=fighter2.width/2;
					if(!this.isPunching)
						this.x+=t1;fighter2.x-=t1;
					return true;
				}
			}
			else
				return false;
		},
		doDamage: function()
		{
			if(this.isPunching && this.isCollidng())
			{
				if(this.dir==fighter2.dir)
					fighter2.getDamaged(50);
				else
					fighter2.getDamaged(25);
			}
		},
		getDamaged: function(x)
		{
			this.health-=x;
			if(this.health <= 0)
			{
				console.log("youwin fighter2");
			}
		}
    };//creating an object


     var fighter2=
    {
    	imgStand1: new Image(),
    	imgStand2: new Image(),
    	imgStand1b: new Image(),
    	imgStand2b: new Image(),
     	imgPunch: new Image(),
     	imgPunchb: new Image(),
     	x:690,
     	y:450,
     	width:80,
     	speed : 5,
     	uVer : 0,
     	aVer : 0,
     	dir : -1,
     	health : 100,
     	move:0,
     	curr:1,
     	timeTillNextPunch : 0,
     	isInAir : false,
     	isPunching : false,
     	jump: function()
     	{	
     		if(!this.isInAir)
     		{	
     			this.uVer = 14;
     			this.aVer = 0.5;
     			this.isInAir = true;
     		}
     	},
     	punch : function()
     	{
     		this.isPunching = true;
     		this.width = 150;
     	},
     	update: function()
     	{
     		if(checkKeyDown('p') && this.timeTillNextPunch == 0)
     		{
     			this.punch();
     			this.timeTillNextPunch = 30;
     		}
     		else if (checkKeyDown('6') && checkKeyDown('8'))
     		{
     			this.move = 1;
     			this.dir = 1;
     			this.jump();	
     		}
     		else if (checkKeyDown('4') && checkKeyDown('8'))
     		{
     			this.move = 1;
     			this.dir = -1;
     			this.jump();	
     		}
     		else if(checkKeyDown('8'))
     			this.jump();
     		else if(checkKeyDown('6'))
     		{
     			this.move = 1;
     			this.dir = 1;
     		}
     		else if(checkKeyDown('4'))
     		{
     			this.move = 1;
     			this.dir = -1;
     		}
  
     		if(this.x>=10 && this.x<=750 && this.move==1)
     		{
     			this.x+=(this.dir*this.speed);
     			this.move=0;
     		}
     		else if(this.x<10)
     		{
     			this.x=10;move=0;
     		}
     		else if(this.x>750)
     		{
     			this.x=750;this.move=0;
     		}

     		this.y-=this.uVer;
     		this.uVer = this.uVer - this.aVer;

     		if(this.y>=450)
     		{
     			this.uVer = 0;
     			this.aVer = 0;
     			this.y = 450;
     			this.isInAir = false;
     		}

     		if(this.timeTillNextPunch!=0)
     		{
     			this.timeTillNextPunch--;
     			if(this.timeTillNextPunch == 20)
     			{
     				this.isPunching = false;
     				this.width = 80;
     			}
     		}

     	},
     	isCollidng:function()
		{
			var t1 =  (this.x-fighter1.x)/2; var t2 = (this.y - fighter2.y)/2
			if(this.dir == 1 && this.x < fighter1.x)
			{
				if((this.x + this.width - fighter1.x) > 0 && Math.abs(fighter2.y - fighter1.y) <80)
				{
					if(!this.isPunching)
						this.x+=t1;fighter1.x-=t1;
					return true;
				}
			}
			else if(this.dir == -1 && this.x > fighter1.x)
			{
				if((this.x - fighter1.x - this.width) < 0 && Math.abs(fighter2.y - fighter1.y) <80)
				{
					//t1+=fighter2.width/2;
					if(!this.isPunching)
						this.x+=t1;fighter1.x-=t1;
					return true;
				}
			}
			else
				return false;
		},
		doDamage: function()
		{
			if(this.isPunching && this.isCollidng())
			{
				if(this.dir!=fighter1.dir)
					fighter1.getDamaged(50);
				else
					fighter1.getDamaged(25);
			}

		},
		getDamaged: function(x)
		{
			this.health-=x;
			if(this.health <= 0)
			{
				console.log("youwin fighter 1");
			}
		}
    };//creating an object


window.onload = function func()
{   
     
 	run();//runs when system staRTS
	


}		

function init()//init window
{


	gameWindow.init();
	
    var ctx = gameWindow.context;
    ctx.fillStyle ="red";
	ctx.fillRect(5,5,345,20);

	ctx.fillStyle ="red";
	ctx.fillRect(450,5,345,20);
	
    var terrain= new Image();
    terrain.onload = function()
    {
    	ctx.drawImage(terrain, 0,600,800,200);
    }
	terrain.src="sprites/terrain.png";
}

function initFighters()//init fighters(sprite address)
{

  
    fighter1.imgStand1.src="sprites/blue/stand1.png";
    fighter1.imgStand2.src="sprites/blue/stand2.png";
    fighter1.imgStand1b.src="sprites/blue/stand1b.png";
    fighter1.imgStand2b.src="sprites/blue/stand2b.png";
    fighter1.imgPunch.src="sprites/blue/punch.png";
    fighter1.imgPunchb.src="sprites/blue/punchb.png";
    fighter2.imgStand1.src="sprites/hue/stand1.png";
    fighter2.imgStand2.src="sprites/hue/stand2.png";
    fighter2.imgStand1b.src="sprites/hue/stand1b.png";
    fighter2.imgStand2b.src="sprites/hue/stand2b.png";
    fighter2.imgPunch.src="sprites/hue/punch.png";
    fighter2.imgPunchb.src="sprites/hue/punchb.png";

}

function gameLoop()//Main GAME loop
{

		checkInput();
		drawFighters();
		

		
		
		
	
}

function drawFighters()//update fighters
{

	var ctx = gameWindow.context;
		if(!fighter1.isPunching)
		{
			ctx.clearRect(fighter1.x,fighter1.y,80,150);
			ctx.clearRect(fighter2.x,fighter2.y,80,150);
		}
		else
		{
			ctx.clearRect(fighter1.x,fighter1.y,150,150);
			ctx.clearRect(fighter2.x,fighter2.y,150,150);
		}
		if(!fighter2.isPunching)
		{
			
			ctx.clearRect(fighter2.x,fighter2.y,80,150);
		}
		else
		{
			ctx.clearRect(fighter2.x,fighter2.y,150,150);
		}
		fighter1.isCollidng();
		fighter2.isCollidng();
		fighter1.doDamage();
		fighter2.doDamage();
		fighter1.update();
		fighter2.update();
		if(fighter1.dir == 1)
		{
			if(fighter1.curr <= 8 && !fighter1.isPunching)
			{
			 	ctx.drawImage(fighter1.imgStand1, fighter1.x,fighter1.y);
			 	fighter1.curr ++;
			}
			else if(!fighter1.isPunching)
			{
			 	
			 	ctx.drawImage(fighter1.imgStand2, fighter1.x,fighter1.y);
			 	fighter1.curr++;
			 	if(fighter1.curr == 16)
			 	{
			 		fighter1.curr=0;
			 	}
			}
			else if(fighter1.isPunching)
			{
				ctx.drawImage(fighter1.imgPunch, fighter1.x,fighter1.y);
			}
		}
		else
		{
			if(fighter1.curr <= 8 && !fighter1.isPunching)
			{
			 	ctx.drawImage(fighter1.imgStand1b, fighter1.x,fighter1.y);
			 	fighter1.curr ++;
			}
			else if(!fighter1.isPunching)
			{
			 	
			 	ctx.drawImage(fighter1.imgStand2b, fighter1.x,fighter1.y);
			 	fighter1.curr++;
			 	if(fighter1.curr == 16)
			 	{
			 		fighter1.curr=0;
			 	}
			}
			else if(fighter1.isPunching)
			{
				ctx.drawImage(fighter1.imgPunchb, fighter1.x,fighter1.y);
			}
		}





		if(fighter2.dir == 1)
		{
			if(fighter2.curr <= 8 && !fighter2.isPunching)
			{
			 	ctx.drawImage(fighter2.imgStand1, fighter2.x,fighter2.y);
			 	fighter2.curr ++;
			}
			else if(!fighter2.isPunching)
			{
			 	
			 	ctx.drawImage(fighter2.imgStand2, fighter2.x,fighter2.y);
			 	fighter2.curr++;
			 	if(fighter2.curr == 16)
			 	{
			 		fighter2.curr=0;
			 	}
			}
			else if(fighter2.isPunching)
			{
				ctx.drawImage(fighter2.imgPunch, fighter2.x,fighter2.y);
			}
		}
		else
		{
			if(fighter2.curr <= 8 && !fighter2.isPunching)
			{
			 	ctx.drawImage(fighter2.imgStand1b, fighter2.x,fighter2.y);
			 	fighter2.curr ++;
			}
			else if(!fighter2.isPunching)
			{
			 	
			 	ctx.drawImage(fighter2.imgStand2b, fighter2.x,fighter2.y);
			 	fighter2.curr++;
			 	if(fighter2.curr == 16)
			 	{
			 		fighter2.curr=0;
			 	}
			}
			else if(fighter2.isPunching)
			{
				ctx.drawImage(fighter2.imgPunchb, fighter2.x,fighter2.y);
			}
		}
}

function run()
{
	init();
 	initFighters();
 	setInterval(gameLoop, 34);
}


function checkInput()
{
	gameWindow.canvas.addEventListener("keydown", keyIsDown, false);
	gameWindow.canvas.addEventListener("keyup", keyIsUp, false);
	//gameWindow.canvas.addEventListener("keypress", keyIsPress, false);
}





	</script>
</head>
<body style="background-color:black">
<canvas id="canvas" width="800" height="800">xx</canvas>


</body>
</html>