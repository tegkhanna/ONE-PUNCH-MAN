<!DOCTYPE html>
<html>
<head>
	<title>Game</title>
	<link rel="stylesheet" type="text/css" href="project.css">
	<script type="text/javascript">


	//game window in form of object
	///MAIN GAME OBJECTS---> GAME WINDOW, GAME STATE(PLAY,LOSE,WHO WINS), GAME FUNCTIONS ---->INITIALIZER,GAMELOOP, RUN, ONLOAD FUNCTION(RUN)
	var gameWindow = 
	{
		canvas : null,
		context : null,
		terrain : new Image(),
		init : function()//initializes the canvas and context
			{
				this.canvas = document.getElementById("canvas");
				this.context = this.canvas.getContext("2d");
				this.terrain.src="sprites/terrain.png";
				this.canvas.tabIndex = 1000;
			}
	};

	var gameState = 
	{
		PLAY:1,
		PAUSE:0,
		WinFighter2:0,
		WinFighter1:0
	};

	function init()//init window
	{
		gameWindow.init();
		initFighters();  
	}
	function gameLoop()//Main GAME loop
	{
		checkInput();
		update();
	}
	function run()
	{
		init();
	 	setInterval(gameLoop, 34);
	}
	window.onload = function func()
	{
 		run();//runs when system staRTS
	}
	function drawText(text)//SCREEN WRITING FN
	{
		var ctx = gameWindow.context;
		ctx.font = "30px Comic Sans MS";
		ctx.fillStyle = "red";
		ctx.textAlign = "center";
		ctx.fillText(text, gameWindow.canvas.width/2, gameWindow.canvas.height/2);
	}




	
	///BEGIN EVENT MANAGER..TRIED TO PUT IN A OBJECT, BUT down IS DOING PROBLEM AS AN OBJECT ELEMENT

	var down = [];//array  having down key 
	function checkInput()//BROWSER EVENT REGISTER
	{
		gameWindow.canvas.addEventListener("keydown", keyIsDown, false);
		gameWindow.canvas.addEventListener("keyup", keyIsUp, false);
		//gameWindow.canvas.addEventListener("keypress", keyIsPress, false);
	}

	function keyIsDown(e)//adding key to donw
	{
		if(down.indexOf(e.keyCode) == -1)
		{
			down.push(e.keyCode);
		}
	}
	function keyIsUp(e)//remove key from down
	{
		if(down.indexOf(e.keyCode) != -1)
		{
			down.splice(down.indexOf(e.keyCode), 1);
		}
	}

	function checkKeyDown(x)//checks that a given key x is down
	{
		if(x == 'w')
			x = 87;
		else if(x == 'a')
			x=65;
		else if(x=='s')
			x=83;
		else if(x=='d') 
			x=68;
		else if(x==' ') 
			x=32;
		else if(x == '8')
			x = 104;
		else if(x == '4')
			x=100;
		else if(x=='5')
			x=101;
		else if(x=='6') 
			x=102;
		else if(x=='p') 
			x=80;
		if(down.indexOf(x)!=-1)
			return true;
		else
			return false;
	}
	
	///EVEN MANAGER OVER





	/*FIGHTER OBJECTS->(TO DO LATER MAKE AGENT OBJECT AND MAKE NESTED OBJECT AS FIGHTER1 AND FIGHTER2)
	(THIS WILL HELP IN CREATING JUST ONE DAMAGE AND COLLISION CONTROL)(I THINK)(SOMETHING RELATED TO INHERRITANCE)*/

	var fighter1=//fighter 1 object..has images..posiition..velocities..updates
    {
    	imgStand1: new Image(),
    	imgStand2: new Image(),
    	imgStand1b: new Image(),//B=TURNED AROUND
    	imgStand2b: new Image(),
     	imgPunch: new Image(),
     	imgPunchb: new Image(),
     	imgLose: new Image(),
     	imgWin: new Image(),
     	x:10,
     	y:450,
     	width:80,//CHANGES WITH PUNCH STATE
     	speed : 5,//INCREASE LATER
     	health:100,
     	uVer : 0,
     	aVer : 0,
     	dir : 1,
     	shouldMove:0,
     	currImageTick:1,//without this image flip toooo fast
     	timeTillNextPunch : 0,
     	isInAir : false,
     	isPunching : false,
     	jump: function()
     	{	
     		if(!this.isInAir)
     		{	
     			this.uVer = 14;
     			this.aVer = 0.5;//change soon
     			this.isInAir = true;
     		}
     	},
     	punch : function()
     	{
     		this.isPunching = true;//function to set this false at bottom
     		this.width = 150;
     	},
     	update: function()
     	{
     		if(checkKeyDown('q') && this.timeTillNextPunch == 0)
     		{
     			this.punch();
     			this.timeTillNextPunch = 30;
     		}
     		else if (checkKeyDown('d') && checkKeyDown('w'))
     		{
     			this.shouldMove = 1;
     			this.dir = 1;
     			this.jump();	
     		}
     		else if (checkKeyDown('a') && checkKeyDown('w'))
     		{
     			this.shouldMove = 1;
     			this.dir = -1;
     			this.jump();	
     		}
     		else if(checkKeyDown('w'))
     			this.jump();
     		else if(checkKeyDown('d'))
     		{
     			this.shouldMove = 1;
     			this.dir = 1;
     		}
     		else if(checkKeyDown('a'))
     		{
     			this.shouldMove = 1;
     			this.dir = -1;
     		}
  
     		if(this.x>=10 && this.x<=750 && this.shouldMove==1)
     		{
     			this.x+=(this.dir*this.speed);
     			this.shouldMove=0;
     		}
     		else if(this.x<10)
     		{
     			this.x=10;shouldMove=0;
     		}
     		else if(this.x>750)
     		{
     			this.x=750;this.shouldMove=0;
     		}

     		this.y-=this.uVer;
     		this.uVer = this.uVer - this.aVer;

     		if(this.y>=450)
     		{
     			this.uVer = 0;
     			this.aVer = 0;
     			this.y = 450;
     			this.isInAir = false;
     		}

     		if(checkKeyDown(' ') && this.timeTillNextPunch == 0)
     		{
     			this.punch();
     			this.timeTillNextPunch = 25;
     		}
     		if(this.timeTillNextPunch!=0)
     		{
     			this.timeTillNextPunch--;
     			if(this.timeTillNextPunch == 20)
     			{	
     				this.isPunching = false;
     				this.width = 80;
     			}
     		}

     	},
     	isCollidng:function()
		{	//I KNEW WHAT I AM DOING.. NOW I SEEM TO FORGET .. THANSK TO MY PURSE AND PHONE.. THEY HELPED IN DESIGNING THIS :P
			//UPDATE COMMENTS PLSSSS/
			//P.S NO Y PUSH BACK :P UNNOTICABLE ;)/
			var t1 =  (this.x-fighter2.x)/2; var t2 = (this.y - fighter1.y)/2;
			if(this.dir == 1 && this.x < fighter2.x)
			{
				if((this.x + this.width - fighter2.x) > 0 && Math.abs(fighter1.y - fighter2.y) <80)
				{
					if(!this.isPunching)
						this.x+=t1/4;fighter2.x-=t1/4;
					return true;
				}
			}
			else if(this.dir == -1 && this.x > fighter2.x)
			{
				if((this.x - fighter2.x - this.width) < 0 && Math.abs(fighter1.y - fighter2.y) <80)
				{
					//t1+=fighter2.width/2;
					if(!this.isPunching)
						this.x+=t1/4;fighter2.x-=t1/4;
					return true;
				}
			}
			else
				return false;
		},
		doDamage: function()
		{
			if(this.isPunching && this.isCollidng())
			{
				if(this.dir!=fighter2.dir)
					fighter2.getDamaged(10);
				else
					fighter2.getDamaged(25);
			}
		},
		getDamaged: function(x)
		{
			this.health-=x;
			if(this.health <= 0)
			{
				console.log("youwin fighter2");
				gameState.PAUSE = 1;
				gameState.WinFighter2 = 1;
			}
		}
    };//creating an object

    //REFER FIGHTER 1 FOR COMMENTS
    var fighter2=
    {
    	imgStand1: new Image(),
    	imgStand2: new Image(),
    	imgStand1b: new Image(),
    	imgStand2b: new Image(),
     	imgPunch: new Image(),
     	imgPunchb: new Image(),
     	imgLose: new Image(),
     	imgWin: new Image(),
     	x:690,
     	y:450,
     	width:80,
     	speed : 5,
     	uVer : 0,
     	aVer : 0,
     	dir : -1,
     	health : 100,
     	shouldMove:0,
     	currImageTick:1,
     	timeTillNextPunch : 0,
     	isInAir : false,
     	isPunching : false,
     	jump: function()
     	{	
     		if(!this.isInAir)
     		{	
     			this.uVer = 14;
     			this.aVer = 0.5;
     			this.isInAir = true;
     		}
     	},
     	punch : function()
     	{
     		this.isPunching = true;
     		this.width = 150;
     	},
     	update: function()
     	{
     		if(checkKeyDown('p') && this.timeTillNextPunch == 0)
     		{
     			this.punch();
     			this.timeTillNextPunch = 30;
     		}
     		else if (checkKeyDown('6') && checkKeyDown('8'))
     		{
     			this.shouldMove = 1;
     			this.dir = 1;
     			this.jump();	
     		}
     		else if (checkKeyDown('4') && checkKeyDown('8'))
     		{
     			this.shouldMove = 1;
     			this.dir = -1;
     			this.jump();	
     		}
     		else if(checkKeyDown('8'))
     			this.jump();
     		else if(checkKeyDown('6'))
     		{
     			this.shouldMove = 1;
     			this.dir = 1;
     		}
     		else if(checkKeyDown('4'))
     		{
     			this.shouldMove = 1;
     			this.dir = -1;
     		}
  
     		if(this.x>=10 && this.x<=750 && this.shouldMove==1)
     		{
     			this.x+=(this.dir*this.speed);
     			this.shouldMove=0;
     		}
     		else if(this.x<10)
     		{
     			this.x=10;shouldMove=0;
     		}
     		else if(this.x>750)
     		{
     			this.x=750;this.shouldMove=0;
     		}

     		this.y-=this.uVer;
     		this.uVer = this.uVer - this.aVer;

     		if(this.y>=450)
     		{
     			this.uVer = 0;
     			this.aVer = 0;
     			this.y = 450;
     			this.isInAir = false;
     		}

     		if(this.timeTillNextPunch!=0)
     		{
     			this.timeTillNextPunch--;
     			if(this.timeTillNextPunch == 20)
     			{
     				this.isPunching = false;
     				this.width = 80;
     			}
     		}

     	},
     	isCollidng:function()
		{
			var t1 =  (this.x-fighter1.x)/2; var t2 = (this.y - fighter2.y)/2;
			if(this.dir == 1 && this.x < fighter1.x)
			{
				if((this.x + this.width - fighter1.x) > 0 && Math.abs(fighter2.y - fighter1.y) <80)
				{
					if(!this.isPunching)
						this.x+=t1/4;fighter1.x-=t1/4;
					return true;
				}
			}
			else if(this.dir == -1 && this.x > fighter1.x)
			{
				if((this.x - fighter1.x - this.width) < 0 && Math.abs(fighter2.y - fighter1.y) <80)
				{
					//t1+=fighter2.width/2;
					if(!this.isPunching)
						this.x+=t1/4;fighter1.x-=t1/4;
					return true;
				}
			}
			else
				return false;
		},
		doDamage: function()
		{
			if(this.isPunching && this.isCollidng())
			{
				if(this.dir!=fighter1.dir)
					fighter1.getDamaged(10);
				else
					fighter1.getDamaged(25);
			}

		},
		getDamaged: function(x)
		{
			this.health-=x;
			if(this.health <= 0)
			{
				console.log("youwin fighter 1");
				gameState.PAUSE = 1;
				gameState.WinFighter1 = 1;
			}
		}
    };//creating an object




	function initFighters()//init fighters(sprite address)
	{
	    fighter1.imgStand1.src="sprites/blue/stand1.png";
	    fighter1.imgStand2.src="sprites/blue/stand2.png";
	    fighter1.imgStand1b.src="sprites/blue/stand1b.png";
	    fighter1.imgStand2b.src="sprites/blue/stand2b.png";
	    fighter1.imgPunch.src="sprites/blue/punch.png";
	    fighter1.imgPunchb.src="sprites/blue/punchb.png";
	    fighter1.imgWin.src="sprites/blue/win.png";
	    fighter1.imgLose.src="sprites/blue/lose.png";
	    fighter2.imgStand1.src="sprites/hue/stand1.png";
	    fighter2.imgStand2.src="sprites/hue/stand2.png";
	    fighter2.imgStand1b.src="sprites/hue/stand1b.png";
	    fighter2.imgStand2b.src="sprites/hue/stand2b.png";
	    fighter2.imgPunch.src="sprites/hue/punch.png";
	    fighter2.imgPunchb.src="sprites/hue/punchb.png";
	    fighter2.imgWin.src="sprites/hue/win.png";
	    fighter2.imgLose.src="sprites/hue/lose.png";
	}


			

	function clearScreen()
	{
			var ctx = gameWindow.context;
			ctx.clearRect(0,0,800,800);
	}
	function update()//CLEAR SCREEN, COLLISSION CHECK, DAMAGE CHECK, UPDATE, DRAW FIGHTERS ON SCREEN,DRAW FIGHTER HEALTH, CHECK WIN
	{


			clearScreen();
			fighter1.isCollidng();
			fighter2.isCollidng();
			fighter1.doDamage();
			fighter2.doDamage();
			if(gameState.WinFighter1 == 0 && gameState.WinFighter2 == 0)
			{	
				fighter1.update();
				fighter2.update();
			}
			drawHealth();
			drawFighter();
			checkWin();
	}
	function drawFighter()//DRAWS UPDATED FIGHTERS
	{

			var ctx = gameWindow.context;
			//WAITING FOR BACK GROUND
	    	ctx.drawImage(gameWindow.terrain, 0,600,800,200);//TERRAIN


	    	//PLAYER 1
			if(gameState.WinFighter1 == 1)//WIN IMAGES
			{
				ctx.drawImage(fighter1.imgWin,fighter1.x,fighter1.y);
				ctx.drawImage(fighter2.imgLose,fighter2.x,fighter2.y + 99);
					
			}
			else if(gameState.WinFighter2 == 1)
			{
				ctx.drawImage(fighter2.imgWin,fighter2.x,fighter2.y);
				ctx.drawImage(fighter1.imgLose,fighter1.x,fighter1.y + 99);
			}

			else if(fighter1.dir == 1)
			{
				
				if(fighter1.currImageTick <= 8 && !fighter1.isPunching)
				{
				 	ctx.drawImage(fighter1.imgStand1, fighter1.x,fighter1.y);
				 	fighter1.currImageTick ++;
				}
				else if(!fighter1.isPunching)
				{
				 	
				 	ctx.drawImage(fighter1.imgStand2, fighter1.x,fighter1.y);
				 	fighter1.currImageTick++;
				 	if(fighter1.currImageTick == 16)
				 	{
				 		fighter1.currImageTick=0;
				 	}
				}
				else if(fighter1.isPunching)
				{
					ctx.drawImage(fighter1.imgPunch, fighter1.x,fighter1.y);
				}
			}
			else
			{
				if(fighter1.currImageTick <= 8 && !fighter1.isPunching)
				{
				 	ctx.drawImage(fighter1.imgStand1b, fighter1.x,fighter1.y);
				 	fighter1.currImageTick ++;
				}
				else if(!fighter1.isPunching)
				{
				 	
				 	ctx.drawImage(fighter1.imgStand2b, fighter1.x,fighter1.y);
				 	fighter1.currImageTick++;
				 	if(fighter1.currImageTick == 16)
				 	{
				 		fighter1.currImageTick=0;
				 	}
				}
				else if(fighter1.isPunching)
				{
					ctx.drawImage(fighter1.imgPunchb, fighter1.x,fighter1.y);
				}
			}




			if(gameState.WinFighter1 == 1)
			{
				ctx.drawImage(fighter1.imgWin,fighter1.x,fighter1.y);
				ctx.drawImage(fighter2.imgLose,fighter2.x,fighter2.y + 99);
					
			}
			else if(gameState.WinFighter2 == 1)
			{
				ctx.drawImage(fighter2.imgWin,fighter2.x,fighter2.y);
				ctx.drawImage(fighter1.imgLose,fighter1.x,fighter1.y + 99);
			}
			else if(fighter2.dir == 1)
			{	
				
				if(fighter2.currImageTick <= 8 && !fighter2.isPunching)
				{
				 	ctx.drawImage(fighter2.imgStand1, fighter2.x,fighter2.y);
				 	fighter2.currImageTick ++;
				}
				else if(!fighter2.isPunching)
				{
				 	
				 	ctx.drawImage(fighter2.imgStand2, fighter2.x,fighter2.y);
				 	fighter2.currImageTick++;
				 	if(fighter2.currImageTick == 16)
				 	{
				 		fighter2.currImageTick=0;
				 	}
				}
				else if(fighter2.isPunching)
				{
					ctx.drawImage(fighter2.imgPunch, fighter2.x,fighter2.y);
				}
			}
			else
			{
				if(fighter2.currImageTick <= 8 && !fighter2.isPunching)
				{
				 	ctx.drawImage(fighter2.imgStand1b, fighter2.x,fighter2.y);
				 	fighter2.currImageTick ++;
				}
				else if(!fighter2.isPunching)
				{
				 	
				 	ctx.drawImage(fighter2.imgStand2b, fighter2.x,fighter2.y);
				 	fighter2.currImageTick++;
				 	if(fighter2.currImageTick == 16)
				 	{
				 		fighter2.currImageTick=0;
				 	}
				}
				else if(fighter2.isPunching)
				{
					ctx.drawImage(fighter2.imgPunchb, fighter2.x,fighter2.y);
				}
			}
	}
	function drawHealth()//DRAW HEALTH OF FIGHTERS(RED BAR)
	{
		var ctx = gameWindow.context;
		ctx.clearRect(5,5,345,20)
		ctx.clearRect(450,5,345,20)
		ctx.fillStyle ="red";
		if(345*fighter1.health/100 > 0 )
			ctx.fillRect(5,5,345*fighter1.health/100,20);
		else
			ctx.fillRect(5,5,0,20);
		ctx.fillStyle ="red";
		if(345*fighter2.health/100 > 0)
			ctx.fillRect(450,5,345*fighter2.health/100,20);
		else
			ctx.fillRect(450,5,0,20);
	}

	function checkWin()//CHECK WINNING AND WRITE ON SCREE
	{
		if(gameState.WinFighter1)
		{
			drawText("FIGHTER 1 WON!!");
		}
		else if(gameState.WinFighter2)
		{
			drawText("FIGHTER 2 WON!!");
		}
	}

	</script>
</head>
<body style="background-color:black">
<canvas id="canvas" width="800" height="800">xx</canvas>


</body>
</html>